<!DOCTYPE html>
<html>
<head>

<title>Shine</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script src="raphael.js"></script>

<style type="text/css">
body {
  max-width: 960px;
  margin: 0 auto;
}
.hidden {
  display: none;
}
h1, #nav {
  margin: 0;
  text-align: center;
}
input {
  width: 25px;
}
#toolbar {
  float: left;
  border: solid 1px black;
  height: 560px;
  width: 100px;
}
#toolbar p {
  margin: 0;
  font-size: .8em;
}
#rect_button span {
  display: inline-block;
  border: solid 1px black;
  height: 6px;
  width: 8px;
}
#newsave {
  border-right: solid 1px black;
  border-bottom: solid 1px black;
  padding: .5em;
}
#zoomslider {
  position: relative;
  top: 10px;
}
#user_canvas {
  float: left;
  border: solid 1px black;
  position: relative;
}
#user_canvas_overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 1;
}
#shapes_list {
  float: left;
  border: solid 1px black;
  height: 480px;
  width: 200px;
  overflow-y: scroll;
}
#shapes_list p {
  margin: 0;
  cursor: pointer;
}
#shapes_list .current {
  background-color: mediumblue;
  color: white;
}
#shapes_list input {
  width: 100px;
}
#user_canvas_controls {
  float: left;
  border: solid 1px black;
}
#timeslider {
  position: relative;
  top: 10px;
}
</style>

</head>
<body>

<h1>Shine</h1>

<p id="nav">
  <a href="/">Shine</a> |
  <a href="instructions">Instructions</a> |
  <a href="about">About</a> |
  <a href="news">News</a>
</p>

<div id="toolbar">
  <p><button id="rect_button"><span></span> Rect</button>
  <p class="hidden">Thickness
    <br>Corner Radius
    <br>Fill
  <p><button id="text_button">Text</button>
  <p class="hidden">Size
    <br>Font
</div>

<p>
  <span id="newsave">
    <button>New</button>
    <button>Save</button>
  </span>
  <label for="width">Width:</label>
  <input type="text" id="width" value=640>
  <label for="height">Height:</label>
  <input type="text" id="height" value=480>
  <label for="zoom">Zoom:</label>
  <input type="text" id="zoom" value="100%" style="width:25px">
  <span id="zoomslider"></span>
</p>

<div id="user_canvas">
  <div id="user_canvas_overlay"></div>
</div>

<div id="shapes_list"></div>

<div id="user_canvas_controls">
  <button>&#9654;Play</button>
  <span id="timeslider"></span>
  <input type="text" id = "current_time" value="0.0s">/<input type="text" id = "time_length" value="5.0s">
</div>

<script type="text/javascript">
var zoomslider = Raphael('zoomslider', 200, 30),
  zoombar = zoomslider.path('M 0 15 L 200 15'),
  zoom_overlay = zoomslider.rect(0, 0, 200, 30).attr({fill:'#000', opacity: 0}),
  zoomknob = zoomslider.rect(50, 5, 6, 20).attr({fill: '#000', stroke: 'none'});

var zoom = 100, zoom_startX;
function zoom_move(dx, dy){
  zoom = zoom_startX + dx + 50;
  zoom = zoom < 50 ? 50 : (zoom > 250 ? 250 : zoom);
  $('#zoom').val(zoom+'%');
  zoomknob.attr('x', zoom - 53);
}
zoomknob.drag(zoom_move, function(){ //start
  zoom_startX = zoomknob.attr('x') + 3;
});
zoom_overlay.drag(zoom_move, function(x, y, e){ //start
  zoom_startX = e.offsetX;
  zoom = zoom_startX + 50;
  $('#zoom').val(zoom+'%');
  zoomknob.attr('x', zoom_startX - 3);
});



var timeslider = Raphael('timeslider', 480, 30),
  timebar = timeslider.path('M 0 15, L 480 15'),
  time_overlay = timeslider.rect(0, 0, 480, 30).attr({fill:'#000', opacity: 0}),
  timeknob = timeslider.rect(-3, 5, 6, 20).attr({fill: '#000', stroke: 'none'});

var time = 0, start_time, time_length = 5000;
function time_move(dx, dy){
  time = Math.round((start_time+dx)*time_length/480);
  time = time < 0 ? 0 : (time > time_length ? time_length : time);
  $('#current_time').val((time/1000).toFixed(1)+'s');
  timeknob.attr('x', Math.round(time*480/time_length) - 3);
}
timeknob.drag(time_move, function(){ //start
  start_time = timeknob.attr('x') + 3;
});
time_overlay.drag(time_move, function(x, y, e){ //start
  start_time = e.offsetX;
  time = Math.round(start_time*time_length/480);
  $('#current_time').val((time/1000).toFixed(1)+'s');
  timeknob.attr('x', start_time - 3);
});








var user_canvas = Raphael('user_canvas', 640, 480);
user_canvas.text(200,150,'hello world').attr('font-size',40);

//list of raphael shapes and sets
var shapes_list = $('#shapes_list').click(function(){
  current_shape.removeClass('current');
  shape_options.detach();
});

//shape in list
var current_shape = $(), shape_options = $('<p></p>').click(function(){
  return false;
});
var rename = $('<form>Rename: <input type="text" name="rename"></form></p>').submit(function(){
  shape_options.prev().html(this.rename.value);
  return false;
}).appendTo(shape_options).find('input');
$('<button>Remove</button>').click(function(){
  var shape = shape_options.prev();
  shape.data('raphael').remove();
  shape.remove();
  shape_options.detach();
}).appendTo(shape_options);
function shape_click(){
  current_shape.removeClass('current');
  current_shape = $(this).addClass('current');
  rename.val(this.innerHTML);
  shape_options.insertAfter(this);
  return false;
}

//catches all the mouse events over the user_canvas
var overlay = $('#user_canvas_overlay');

//show/hide toolbar button options
var current_button_description = $();
$('#toolbar button').click(function(){
  current_button_description.hide();
  current_button_description = $(this).parent().next().show();
  overlay.unbind();
});

//rectangle tool
var rect_count = 0;
$('#rect_button').click(function(){
  overlay.mousedown(function(e){
    var startX = e.offsetX, startY = e.offsetY, rect_jQ,
      rect = user_canvas.rect(startX, startY, 0, 0);

    rect_count += 1;
    rect_jQ = $('<p>Rectangle '+rect_count+'</p>').data('raphael', rect)
      .click(shape_click).appendTo(shapes_list);

    overlay.mousemove(function(e){
      var x = e.offsetX, y = e.offsetY;
      rect.attr({
        x: x > startX ? startX : x,
        y: y > startY ? startY : y,
        width: x > startX ? x - startX : startX - x,
        height: y > startY ? y - startY : startY - y
      });
    }).bind('mouseup mouseleave', function(){
      overlay.unbind('mousemove mouseup mouseleave');
    }).mouseleave(function(){
      rect_jQ.remove();
      rect.remove();
      rect_count -= 1;
    });
  });
});




</script>

</body>
</html>
